name: CI
on:
  push:
    branches: [ master ]
jobs:
  to_codecommit:                                        # <-- different jobs are executed in parallel.
    runs-on: ubuntu-18.04
    steps:
    - uses: actions/checkout@v1
    - uses: pixta-dev/repository-mirroring-action@v1
      with:
        target_repo_url:
          ssh://git-codecommit.us-east-1.amazonaws.com/v1/repos/congress
        ssh_private_key:
          ${{ secrets.SSH_PRIVATE_KEY }}
        ssh_username:                                   # <-- (for codecommit) you need to specify ssh-key-id as ssh username.
          ${{ secrets.SSH_KEY_ID }}
#   codecommit:
#     runs-on: ubuntu-latest
#     steps:
#       - uses: actions/checkout@v2
#       - name: pushes to codecommit
#         run: |
#           mkdir .ssh && cd .ssh && echo "$SSH_PRIVATE_KEY" > id_rsa && chmod 600 id_rsa
#           echo "$SSH_CONFIG" > config && chmod 600 config && cd ..
#           git remote add codecommit "$CODECOMMIT_URL"
#           git push codecommit master --force
#           echo "$(ls -a)"
#         shell: bash
#         env:
#           CODECOMMIT_URL: ${{ secrets.CODECOMMIT_URL }}
#           SSH_CONFIG: ${{ secrets.SSH_CONFIG }}
#           SSH_PRIVATE_KEY: ${{ secrets.SSH_PRIVATE_KEY }}
#           SSH_USERNAME: ${{ secrets.SSH_USERNAME }}


        # echo "$(ssh -i id_rsa -o StrictHostKeyChecking=no -l $SSH_USERNAME)"
        # echo "$SSH_CONFIG" > config && chmod 600 config && cd ..
        # echo "$(ls .ssh -a)"
        # echo "$(cat .ssh/id_rsa)"
        # echo ${{ secrets.GIT_CREDENTIALS }} > git-credentials.txt
        # git config --global credential.helper 'store --file git-credentials.txt'
        # git remote add codecommit ${{ secrets.CODECOMMIT_URL }}
        # git push codecommit master
        # echo "$(ls)"
        # run: |
        #   'echo "$GIT_CREDENTIALS" > .git-credentials'
        #   cat .git-credentials
        #   git config --global credential.helper 'store --file .git-credentials'
        #   git remote add codecommit "$CODECOMMIT_URL"
        #   git push codecommit master
        # shell: bash
        #   GIT_CREDENTIALS: ${{ secrets.GIT_CREDENTIALS }}
        #   CODECOMMIT_URL: ${{ secrets.CODECOMMIT_URL }}
